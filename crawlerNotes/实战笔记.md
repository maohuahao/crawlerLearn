## 网易云请求表单加密

主要方法就是扣去`js`加密代码，然后通过python执行`js`代码获取加密后的参数，在进行提交请求。

```js
目标网址：https://music.163.com/weapi/song/enhance/player/url/v1?csrf_token=
加密的参数：params、encSecKey
结果：获取音乐链接
```

### 问题

通过node环境运行`js`代码时，能够获取正确的加密参数（长度为256）。但是通过python的`pyexecjs`库运行得到的长度不对，并且提交请求后不会得到任何返回值。之后，根据网上资料了解到python在执行一些具有位运算的`js`代码时可能产生错误。所以选择直接使用python原生的`os`或subprocess库来执行`js`代码，使用这种方式的执行效率也比第三方的库要快得多。

#### 使用方法

1. 首先电脑环境要安装`nodejs`

2. 通过`os.popen`执行node调用`js`代码

```python
import os
data = os.popen(node js代码 参数1 参数2 ...).readlines() # 返回一个列表根据你的在js代码中输出来默认会个每个输出加上一个换行，需要去掉
```

传入的参数前两个是node命令的路径和执行的js代码的绝对路径，需要进行处理，如下

```js
var arguments = process.argv.splice(2) // 通过数组方式获取参数
```

